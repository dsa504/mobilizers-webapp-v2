<template id="select-program-member">
  <div class="select-program-member">
    <md-card>
      <md-card-content style="padding-bottom:0px;">
        <div>
          Please select your name to get started!
        </div>
        
        <md-field>
          <label for="mobilizers">Mobilizer</label> 
          <md-select name="mobilizers" id="mobilizers" v-model="selectedMobilizerName">  
            <md-option v-for="mn in mobilizerNames" :key="mn" :value="mn">
              {{ mn }}
            </md-option>
          </md-select>
        </md-field>
      </md-card-content>
    </md-card>
    
    <md-card v-if="selectedMobilizerName">
      <md-card-content style="padding-bottom:20px;padding-top:0px;">
        <md-field>
          <label for="programMembers">Program Member</label>
          <md-select 
            id="programMembers" 
            name="programMembers" 
            v-model="selectedProgramMemberId"
          >
            <md-option v-for="pm in assignedMembers" :key="pm.name" :value="pm.id">
              {{ pm.name }}
            </md-option>
          </md-select>
        </md-field>
        
        
        
        
      </md-card-content>
    </md-card>
  </div>
</template>

<script>
  (function () {
    window.vueComponents = window.vueComponents || {};
    
    window.vueComponents.selectProgramMember = {
      template: "#select-program-member",
      props: {
        programMembers: { type: Array, required: true } 
      },
      data: function() { return {
        selectedMobilizerName: null,
        selectedProgramMemberId: null,    
      }; },
      methods: {
        onMemberSelect: function(m) {
          if (!m) return;

          this.selectedProgramMemberId = m.id;
        }
      },
      computed: {
        mobilizerNames: function() {
          return this.$props.programMembers
            .reduce(function(m, pm) {
              if (m.indexOf(pm.mobilizer) === -1) 
                m.push(pm.mobilizer);

              return m;
            }, [])
            .sort();
        },
        selectedProgramMember: function() {
          var component = this;
          return this.programMembers
            .find(function(pm) {
              pm.id === component.selectedProgramMemberId;
            });
        },
        assignedMembers: function() {
          var component = this;
          return this.$props.programMembers
            .filter(function(pm) {
              return pm.mobilizer === component.selectedMobilizerName; 
            });
        },
      },
      watch: {
        selectedProgramMember: function(newVal) {
          this.$emit("select-program-member", newVal);
        },
        selectedMobilizerName: function(newVal) {
          this.$emit("select-mobilizer", newVal);
        }
      }
    };
  })();
</script>