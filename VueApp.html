<script>
//
// Field options
//
var programsAndCommittees = [
  "Communications",
  "Direct Service/Brake Lights",
  "Healthcare For All",
  "Immigration Working Group",
  "Labor Standing",
  "Municipal Action",
  "Socialist Feminist Caucus",
  "Political Education",
  "Socialists Of Color",
  "Tech",
  "Other",
];

var initialTextResponses = [
  "Call Scheduled",
  "Left Town / Not Interested",
  "No Reply",
];

var meetingScheduledResponses = [
  "Meetup Scheduled",
  "Can't/May Attend Later Events",
  "Not Interested",
  //"Other",
];

// *********
// Vue
// *********
Vue.use(VueMaterial.default);
var app = new Vue({
  el: '#app',
  components: {
    "login-dialog": window.vueComponents.loginDialog,
    "select-program-member": window.vueComponents.selectProgramMember,
    "intake-form": window.vueComponents.intakeForm,
  },
  data: {
    activeProgramMember: "",       
    dataLoaded: false,         
    showLogin: true,
    showSteps: true,
    presets: {
      initialTextResponses: initialTextResponses,
      programsAndCommittees: programsAndCommittees,
      meetingScheduledResponses: meetingScheduledResponses,
    },
  },
  computed: {},
  watch: {},
  methods: {
    onLoginSuccess: function() {
      this.showLogin = false;
    },
    getData: function(){ 
      console.log("Fetching Data...");
      google.script.run
        .withSuccessHandler(function(data) {
          this.formData = data;
          this.formDataLoaded = true;
        })
        .getSpreadsheet();
    },
    // put the spreadsheet data
    //
    putSpreadsheetData: function(){ 
      var output = this.formData[this.activeProgramMember];
      console.log("sending active row: " + this.activeProgramMember);
      console.log(output);
      google.script.run
        .withSuccessHandler(function() {
          console.log("data PUT"); 
        })
        .updateSpreadsheet(this.activeProgramMember, output);
    },
    //
    // If there's no response to initial text, or they're not interested, hide the rest of the steps
    //
    showHideSteps: function(){
      var initText = this.formData[this.activeProgramMember][columnMap.initialTextResponse.id];
      if (initText == "Call Scheduled" || initText == "") {
        this.formOptions.showSteps = true;
      } else {
        this.formOptions.showSteps = false;
      }
    },
    //
    // Select a Program Member from the table
    //
    onTableSelect: function (item) { 
      if(typeof item != 'undefined' && item != null){ 
        this.activeProgramMember = item.id;
      };
    },
    //
    // Toggle the "Marked as Done" button
    //
    doneButtonToggle: function(state) {
      if( state == "Open"){
        this.tempData.doneButtonState = "Marked Done";
      }
      if( state == "Marked Done"){
        this.tempData.doneButtonState = "Open";
      }
    }
  }
});

</script>