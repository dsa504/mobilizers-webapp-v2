<template id="login-dialog">
  <md-dialog 
    :md-active.sync="show" 
    :md-close-on-esc="false" 
    :md-click-outside-to-close="false"
    v-on:keyup.enter="login"
  >
    <md-dialog-title>Please Log In</md-dialog-title>
    <md-dialog-content>
      <md-field>
        <label>Password</label>
        <md-input v-model="pw" type="password"></md-input>
      </md-field>
      <div v-bind:style="errorStyle">
        <span style="color: darkorange">ಠ_ಠ</span>
        <span>Incorrect Password!</span>
      </div>
    </md-dialog-content>
    <md-dialog-actions>
      <md-button @click="login">Login</md-button>
    </md-dialog-actions>
  </md-dialog>
</template>

<script>
  (function() {
    window.vueComponents = window.vueComponents || {};

    window.vueComponents.loginDialog = {
      template: "#login-dialog",
      props: {
        show: {type: Boolean, required: true },
      },
      data: function() { return {
        pw: "",
        showError: false,
      }},
      methods: {
        login: function() {
          var component = this;

          google.script.run
          .withSuccessHandler(function(data) {
            if(data !== "OK") return component.showError = true;
            
            if (data === "OK") component.$emit("login-success");   
          })
          .login( this.pw );
        },
      },
      computed: {
        errorStyle: function() {
          return {
            opacity: (this.showError) ? 1 : 0,
          }
        },
      },
      watch: {
        pw: function(newVal) {
          if (newVal < 3) this.showError = false;
        },
      },
    };
  })();
</script>